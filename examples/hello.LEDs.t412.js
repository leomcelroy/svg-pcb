const ATtiny412 = {"VCC":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,0.075],"layers":["F.Cu"],"index":1},"PA6":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,0.025],"layers":["F.Cu"],"index":2},"PA7":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,-0.025],"layers":["F.Cu"],"index":3},"PA1":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,-0.075],"layers":["F.Cu"],"index":4},"PA2":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,-0.075],"layers":["F.Cu"],"index":5},"UPDI":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,-0.025],"layers":["F.Cu"],"index":6},"PA3":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0.025],"layers":["F.Cu"],"index":7},"GND":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0.075],"layers":["F.Cu"],"index":8}};
const header_UPDI = {"UPDI":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.05],"layers":["F.Cu"],"index":1},"GND":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.05],"layers":["F.Cu"],"index":2}};
const header_power = {"GND":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0.107,-0.05],"layers":["F.Cu"],"index":1},"NC1":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[-0.107,-0.05],"layers":["F.Cu"],"index":2},"NC2":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[-0.107,0.05],"layers":["F.Cu"],"index":4},"V":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0.107,0.05],"layers":["F.Cu"],"index":3}};
const regulator_SOT23 = {"out":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[-0.045,0.0375],"layers":["F.Cu"],"index":1},"in":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[-0.045,-0.0375],"layers":["F.Cu"],"index":2},"gnd":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[0.045,0],"layers":["F.Cu"],"index":3}};
const C_1206 = {"1":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}};
const NMOSFET_SOT23 = {"G":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[0.045,-0.0375],"layers":["F.Cu"],"index":1},"S":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[0.045,0.0375],"layers":["F.Cu"],"index":2},"D":{"shape":"M -0.02,0.012L 0.02,0.012L 0.02,-0.012L -0.02,-0.012L -0.02,0.012","pos":[-0.045,0],"layers":["F.Cu"],"index":3}};
const R_1206 = {"1":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}};
const LED_3014_1100 = {"A":{"shape":"M -0.011,0.027L 0.011,0.027L 0.011,-0.027L -0.011,-0.027L -0.011,0.027","pos":[-0.047,0],"layers":["F.Cu"],"index":1},"C":{"shape":"M -0.036,0.027L 0.036,0.027L 0.036,-0.027L -0.036,-0.027L -0.036,0.027","pos":[0.022,0],"layers":["F.Cu"],"index":2}};


// commands:
//  - SHIFT+ENTER: render
//  - drap & drop file: kicad import


// constants
const width = .84 // board width
const height = .68 // board height
const x = 1 // x origin
const y = 1 // y origin
const zt = 0 // top z
const zb = -0.06 // bottom z
const w = .015 // wire width
const w1 = .02 // wire width
const mask = .004 // solder mask size
const border = 0.05 // rendering border


/* -- DECLARE_PCB -- */
let board = new PCB();

let interior = geo.translate(geo.rectangle(width, height), [x+width/2, y+height/2]);


/* -- ADD_COMPONENTS -- */
let IC1 = board.add(ATtiny412, {translate: pt(x+.44, y+.44), name: 'IC1\nt412'});
let J1 = board.add(header_UPDI, {translate: pt(IC1.posX, y+.23), rotate: 90, name: 'J1\nUPDI'});
let J2 = board.add(header_power, {translate: pt(J1.posX+.28, J1.posY-.04), rotate: 90, name: 'J2\n9V'});
let IC2 = board.add(regulator_SOT23, {translate: pt(J2.posX, J2.posY+.25), name: 'IC2\n5V'});
let C1 = board.add(C_1206, {translate: pt(IC2.posX, IC2.posY+.12), name: 'C1 1uF'});
let T1 = board.add(NMOSFET_SOT23, {translate: pt(IC1.posX-.35, IC1.padY("VCC")+.01), rotate: 90, name: 'T1 N'});
let R1 = board.add(R_1206, {translate: pt(T1.posX+.12, T1.posY+.03), rotate: 90, name: 'R1\n10k'});
let D1 = board.add(LED_3014_1100, {translate: pt(T1.posX-.035, T1.posY-.15), rotate: 90, name: 'D1'});
let D2 = board.add(LED_3014_1100, {translate: pt(D1.posX+.075, D1.posY), rotate: 90, name: 'D2'});
let D3 = board.add(LED_3014_1100, {translate: pt(D1.posX+.15, D1.posY), rotate: 90, name: 'D3'});
let D4 = board.add(LED_3014_1100, {translate: pt(D1.posX, D1.posY-.14), rotate: 90, name: 'D4'});
let D5 = board.add(LED_3014_1100, {translate: pt(D4.posX+.075, D4.posY), rotate: 90, name: 'D5'});
let D6 = board.add(LED_3014_1100, {translate: pt(D4.posX+.15, D4.posY), rotate: 90, name: 'D6'});
let D7 = board.add(LED_3014_1100, {translate: pt(D4.posX, D4.posY-.14), rotate: 90, name: 'D7'});
let D8 = board.add(LED_3014_1100, {translate: pt(D7.posX+.075, D7.posY), rotate: 90, name: 'D8'});
let D9 = board.add(LED_3014_1100, {translate: pt(D7.posX+.15, D7.posY), rotate: 90, name: 'D9'});

board.addShape("interior", interior);


/* -- ADD_WIRES -- */
board.wire([J1.pad("UPDI"),
            pt(IC1.posX+.03, J1.posY),
            pt(IC1.posX+.03, IC1.padY("UPDI")),
            IC1.pad("UPDI")], w);

board.wire([J1.pad("GND"),
            pt(IC1.posX, J1.posY),
            pt(IC1.posX, IC1.padY("GND")),
            IC1.pad("GND")], w);

board.wire([J2.pad("GND"),
            J2.pad("NC1")], w1);

board.wire([IC2.pad("in"),
            pt(IC2.padX("in"), J2.padY("V")),
            J2.pad("V")], w);

board.wire([IC2.pad("gnd"),
            pt(IC2.padX("gnd"), J2.padY("GND")),
            J2.pad("GND")], w1);

board.wire([IC2.pad("gnd"),
            pt(IC2.padX("out")-.04, IC2.posY),
            pt(IC2.padX("out")-.08, IC1.padY("GND")),
            IC1.pad("GND")], w);

board.wire([C1.pad("1"),
            pt(IC1.padX("VCC"), C1.padY("1")),
            IC1.pad("VCC")], w);

board.wire([IC2.pad("out"),
            pt(IC2.padX("out"), C1.padY("1")),
            C1.pad("1")], w);

board.wire([IC2.pad("gnd"),
            pt(IC2.padX("gnd"), C1.padY("2")),
            C1.pad("2")], w1);

board.wire([T1.pad("G"),
            pt(T1.padX("G"), T1.padY("G")+.03)], w1);

board.wire([T1.pad("S"),
            pt(T1.padX("S"), T1.posY+.11),
            pt(C1.padX("2"), T1.posY+.11),
            C1.pad("2")], w1);

board.wire([IC1.pad("PA6"),
            pt(R1.posX, IC1.padY("PA6")),
            R1.pad("1")], w);

board.wire([T1.pad("G"),
            pt(T1.padX("G"), R1.padY("1")+.03),
            pt(T1.padX("G")+.03, R1.padY("1")),
            R1.pad("1")], w);

board.wire([D1.pad("C"),
            pt(D1.padX("C"), T1.padY("D")),
            T1.pad("D")], w1);

board.wire([D1.pad("C"),
            D2.pad("C")], w);

board.wire([D3.pad("C"),
            D2.pad("C")], w);

board.wire([D4.pad("C"),
            D1.pad("A")], w);

board.wire([D5.pad("C"),
            D2.pad("A")], w);

board.wire([D6.pad("C"),
            D3.pad("A")], w);

board.wire([D7.pad("C"),
            D4.pad("A")], w);

board.wire([D7.pad("A"),
            D8.pad("A")], w);

board.wire([D8.pad("C"),
            D5.pad("A")], w);

board.wire([D9.pad("A"),
            D8.pad("A")], w);

board.wire([D9.pad("A"),
            pt(J2.padX("NC2"), D9.padY("A")),
            J2.pad("V")], w1);

board.wire([D9.pad("C"),
            D6.pad("A")], w);


// rendering
renderPCB({
  pcb: board,
  layerColors: {
    "interior": "#002d00ff",
    "B.Cu": "#ff4c007f",
    "F.Cu": "#ff8c00cc",
    "drill": "#ff3300e5",
    "padLabels": "#ffff99e5",
    "componentLabels": "#00e5e5e5",
  },
  limits: {
    x: [x-border, x+width+border],
    y: [y-border, y+height+border]
  },
  mm_per_unit: 25.4
})
