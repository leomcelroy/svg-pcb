/* -- DECLARE_COMPONENTS -- */
const LED_1206 = {"A":{"shape":"M -0.037 0.034L 0.027 0.034L 0.027 -0.034L -0.037 -0.034L -0.037 0.034","pos":[-0.055,0],"layers":["F.Cu"],"index":1},"C":{"shape":"M -0.027 0.034L 0.037 0.034L 0.037 -0.034L -0.027 -0.034L -0.027 0.034","pos":[0.055,0],"layers":["F.Cu"],"index":2}}
const R_1206 = {"1":{"shape":"M -0.032 0.034L 0.032 0.034L 0.032 -0.034L -0.032 -0.034L -0.032 0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032 0.034L 0.032 0.034L 0.032 -0.034L -0.032 -0.034L -0.032 0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}}
const SAMD11C = {"A05":{"shape":"M 0.03,0.015L -0.03,0.015L -0.0305,0.015L -0.031,0.015L -0.0321,0.0149L -0.0331,0.0147L -0.0336,0.0146L -0.0347,0.0142L -0.0356,0.0139L -0.0361,0.0137L -0.0366,0.0135L -0.0371,0.0132L -0.0375,0.013L -0.038,0.0127L -0.0384,0.0125L -0.0392,0.0118L -0.0396,0.0115L -0.0401,0.0112L -0.0412,0.0101L -0.0415,0.0096L -0.0418,0.0092L -0.0425,0.0084L -0.0427,0.008L -0.043,0.0075L -0.0432,0.0071L -0.0435,0.0066L -0.0437,0.0061L -0.0439,0.0056L -0.0442,0.0047L -0.0446,0.0036L -0.0447,0.0031L -0.0449,0.0021L -0.045,0.001L -0.045,-0.001L -0.0449,-0.0021L -0.0447,-0.0031L -0.0446,-0.0036L -0.0442,-0.0047L -0.0439,-0.0056L -0.0437,-0.0061L -0.0435,-0.0066L -0.0432,-0.0071L -0.043,-0.0075L -0.0427,-0.008L -0.0425,-0.0084L -0.0418,-0.0092L -0.0415,-0.0096L -0.0412,-0.0101L -0.0401,-0.0112L -0.0396,-0.0115L -0.0392,-0.0118L -0.0384,-0.0125L -0.038,-0.0127L -0.0375,-0.013L -0.0371,-0.0132L -0.0366,-0.0135L -0.0361,-0.0137L -0.0356,-0.0139L -0.0347,-0.0142L -0.0336,-0.0146L -0.0331,-0.0147L -0.0321,-0.0149L -0.031,-0.015L 0.03,-0.015L 0.03,0.015","pos":[-0.11,0.15],"layers":["F.Cu"],"index":1},"A08":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,0.1],"layers":["F.Cu"],"index":2},"A09":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,0.05],"layers":["F.Cu"],"index":3},"A14":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,0],"layers":["F.Cu"],"index":4},"A15":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,-0.05],"layers":["F.Cu"],"index":5},"RST":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,-0.1],"layers":["F.Cu"],"index":6},"CLK":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[-0.11,-0.15],"layers":["F.Cu"],"index":7},"DIO":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,-0.15],"layers":["F.Cu"],"index":8},"24-":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,-0.1],"layers":["F.Cu"],"index":9},"25+":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,-0.05],"layers":["F.Cu"],"index":10},"GND":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0],"layers":["F.Cu"],"index":11},"VDD":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0.05],"layers":["F.Cu"],"index":12},"A02":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0.1],"layers":["F.Cu"],"index":13},"A04":{"shape":"M -0.03,0.015L 0.03,0.015L 0.03,-0.015L -0.03,-0.015L -0.03,0.015","pos":[0.11,0.15],"layers":["F.Cu"],"index":14}};
const header_SWD_4_1 = {"CLK":{"shape":"M 0.05,0.025L -0.05,0.025L -0.0509,0.025L -0.0517,0.025L -0.0535,0.0248L -0.0552,0.0244L -0.056,0.0243L -0.0578,0.0237L -0.0593,0.0232L -0.0602,0.0229L -0.061,0.0225L -0.0618,0.0221L -0.0625,0.0216L -0.0633,0.0212L -0.064,0.0208L -0.0654,0.0197L -0.0661,0.0191L -0.0668,0.0186L -0.0686,0.0168L -0.0691,0.0161L -0.0697,0.0154L -0.0708,0.014L -0.0712,0.0133L -0.0716,0.0125L -0.0721,0.0118L -0.0725,0.011L -0.0729,0.0102L -0.0732,0.0093L -0.0737,0.0078L -0.0743,0.006L -0.0744,0.0052L -0.0748,0.0035L -0.075,0.0017L -0.075,0.0009L -0.075,0L -0.075,-0.0009L -0.075,-0.0017L -0.0748,-0.0035L -0.0744,-0.0052L -0.0743,-0.006L -0.0737,-0.0078L -0.0732,-0.0093L -0.0729,-0.0102L -0.0725,-0.011L -0.0721,-0.0118L -0.0716,-0.0125L -0.0712,-0.0133L -0.0708,-0.014L -0.0697,-0.0154L -0.0691,-0.0161L -0.0686,-0.0168L -0.0668,-0.0186L -0.0661,-0.0191L -0.0654,-0.0197L -0.064,-0.0208L -0.0633,-0.0212L -0.0625,-0.0216L -0.0618,-0.0221L -0.061,-0.0225L -0.0602,-0.0229L -0.0593,-0.0232L -0.0578,-0.0237L -0.056,-0.0243L -0.0552,-0.0244L -0.0535,-0.0248L -0.0517,-0.025L 0.05,-0.025L 0.05,0.025","pos":[-0.107,0.05],"layers":["F.Cu"],"index":1},"DIO":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0.107,0.05],"layers":["F.Cu"],"index":2},"RST":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[-0.107,-0.05],"layers":["F.Cu"],"index":3},"GND":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0.107,-0.05],"layers":["F.Cu"],"index":4}};
const USB_A_plug = {"5V":{"shape":"M -0.05 0.02L 0.242 0.02L 0.242 -0.02L -0.05 -0.02L -0.05 0.02","pos":[0,0.138],"layers":["F.Cu"],"index":1},"D-":{"shape":"M -0.05 0.02L 0.202 0.02L 0.202 -0.02L -0.05 -0.02L -0.05 0.02","pos":[0,0.039],"layers":["F.Cu"],"index":2},"D+":{"shape":"M -0.05 0.02L 0.202 0.02L 0.202 -0.02L -0.05 -0.02L -0.05 0.02","pos":[0,-0.039],"layers":["F.Cu"],"index":3},"GND":{"shape":"M -0.05 0.02L 0.242 0.02L 0.242 -0.02L -0.05 -0.02L -0.05 0.02","pos":[0,-0.138],"layers":["F.Cu"],"index":4}};
const regulator_SOT23 = {"out":{"shape":"M -0.02 0.012L 0.02 0.012L 0.02 -0.012L -0.02 -0.012L -0.02 0.012","pos":[-0.045,0.0375],"layers":["F.Cu"],"index":1},"in":{"shape":"M -0.02 0.012L 0.02 0.012L 0.02 -0.012L -0.02 -0.012L -0.02 0.012","pos":[-0.045,-0.0375],"layers":["F.Cu"],"index":2},"gnd":{"shape":"M -0.02 0.012L 0.02 0.012L 0.02 -0.012L -0.02 -0.012L -0.02 0.012","pos":[0.045,0],"layers":["F.Cu"],"index":3}};
const C_1206 = {"1":{"shape":"M -0.032 0.034L 0.032 0.034L 0.032 -0.034L -0.032 -0.034L -0.032 0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032 0.034L 0.032 0.034L 0.032 -0.034L -0.032 -0.034L -0.032 0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}};
const test_fablab = {
  "1": {
    "shape": "M 0.3605,0.1997 0.3242,0.1798 V 0.0589 l -0.0673,-0.0352 c -0.0025,4.1077e-4 -0.0173,0.0144 -0.0209,0.0163 -0.0477,0.0266 -0.1179,-0.0085 -0.1571,-0.0789 -0.0392,-0.0704 -0.036,-0.1508 0.0119,-0.1774 0.0477,-0.0266 0.1187,0.0053 0.1579,0.0757 0.0065,0.0114 0.0148,0.0377 0.0187,0.0492 l 0.0574,0.0332 -3.4363e-4,-0.1259 -0.3158,-0.1844 1.6199e-4,-0.0416 c 0.0672,0.0019 0.1349,0.0202 0.197,0.0566 0.193,0.113 0.2605,0.3582 0.1547,0.5533 z",
    "pos":[0.38, 0],
    "origin": [0, 0],
    "layers":["F.Cu"]
  },
  "2": {
    "shape": "m -0.3658,0.2015 c -0.0324,-0.0589 -0.0508,-0.1266 -0.0508,-0.1986 0,-0.2237 0.1775,-0.4057 0.3993,-0.4131 l 3.641e-5,0.0426 -0.0849,0.0494 v 0.0986 c 0.0036,0.0014 0.0068,0.003 0.0101,0.0049 0.047,0.0277 0.0519,0.1064 0.0112,0.1758 -0.0409,0.0694 -0.1122,0.1032 -0.1592,0.0755 -0.047,-0.0277 -0.0519,-0.1064 -0.0112,-0.1758 0.0065,-0.0112 0.0141,-0.0214 0.022,-0.0307 v -0.0732 l -0.1013,0.058 v 0.3632 z",
    "pos":[-0.16, -0.35],
    "origin": [0, 0],
    "layers":["F.Cu"]
  },
  "3": {
    "shape": "m 0.0017,0.4166 c -0.1402,0.0016 -0.2773,-0.0684 -0.3559,-0.1952 l 0.036,-0.0227 0.0985,0.0603 0.0619,-0.0367 c -0.0012,-0.0102 -0.0013,-0.0214 -0.0012,-0.0252 5.539e-4,-0.0546 0.0745,-0.0961 0.155,-0.0952 0.0806,8.4458e-4 0.1379,0.0496 0.1375,0.0977 -4.5226e-4,0.0546 -0.0529,0.0973 -0.1335,0.0997 -0.0274,8.492e-4 -0.0536,-0.0047 -0.0655,-0.0069 l -0.0452,0.0289 0.1074,0.0613 0.3167,-0.1841 0.0363,0.0199 c -0.035,0.0575 -0.0844,0.1072 -0.1468,0.1431 -0.0636,0.0366 -0.1329,0.0544 -0.2013,0.0552 z",
    "pos":[-0.2,0.3],
    "origin": [0, 0],
    "layers":["F.Cu"]
  }
}

// commands:
//  - SHIFT+ENTER: render
//  - drap & drop file: kicad import


// constants
const width = 2.39 // board width
const height = 1.69 // board height
const [x, y] = pt(-1.61074601,-1.21869612); // x origin
// const y = -height/2 // y origin
const zt = 0 // top z
const zb = -0.06 // bottom z
const rv = 0.017 // via size
const rp = 0.031 // pad size
const w = .015 // wire width
const mask = .004 // solder mask size
const border = 0 // rendering border


/* -- DECLARE_PCB -- */
let board = new PCB();

/* -- ADD_COMPONENTS -- */
let R1 = board.add(R_1206, { translate: pt(-0.02482028, -0.8121274), rotate: 24, name: "R1" })
let LED1 = board.add(LED_1206, { translate: pt(-0.19264138, -0.81919355), rotate: 295, name: "LED1" })
let fab = board.add(test_fablab, { translate: pt(-0.81171559, -0.57349695)});
let IC1 = board.add(SAMD11C, {translate: pt(-0.04403899, -0.31184937), name: 'IC1\nD11C'});
let J1 = board.add(header_SWD_4_1, {translate: pt(IC1.posX+0, IC1.padY("CLK")-0.15), name: 'J1 SWD'});
let J2 = board.add(USB_A_plug, {translate: pt(-0.05916114, 0.01358479), rotate: 90, name: 'J2\nUSB'});
let IC2 = board.add(regulator_SOT23, {translate: pt(IC1.padX("A04")+.15, IC1.padY("A08")-.005), rotate: 90, name: 'IC2\n3.3V'});
let C1 = board.add(C_1206, {translate: pt(IC2.posX, IC2.posY-0.2), rotate: 90, name: 'C1\n1uF'});

let interior = geo.translate(geo.rectangle(0.48, 0.58), [J2.posX, J2.posY]);


let interior2 = path([-0.2, -0.04],
                     ["bezier", [-2.6, -0.04],
                                [0.47, 0.17],
                                [-4.86,  -3.23],
                                [3.15, -0.84],
                                [0.14, -0.4],
                                [0.59, -0.04],
                                [0.2, -0.04]],
                    [0.2, -0.04]);

board.addShape("interior", interior);
board.addShape("interior", interior2);

/* -- ADD_WIRES -- */
board.wire(path(J1.pad("CLK"),
            ["bezier", [IC1.padX("CLK")-0.05, J1.padY("CLK")+0.08]],
            IC1.pad("CLK"),), w)

board.wire(path(J1.pad("DIO"),
            ["bezier", [IC1.padX("DIO")+0.05, J1.padY("DIO")+0.08]],
            IC1.pad("DIO"),), w)

board.wire(path(J1.pad("RST"),
            ["bezier", [IC1.padX("RST")-0.17, J1.padY("RST")-0.06],
                        [IC1.padX("RST")-0.14, IC1.padY("RST")+0.05],],
            IC1.pad("RST"),), w)

board.wire(path(J2.pad("D-"),
            ["bezier", [J2.padX("D-")+0.023, J2.padY("D-")-0.09],
                        [IC1.posX-0.054, J2.padY("D-")-0.109],
                        [IC1.posX-0.097, IC1.padY("24-")-0.027]],
            IC1.pad("24-"),), w)

board.wire(path(J2.pad("D+"),
            ["bezier", [J2.padX("D+")+0.01, J2.padY("D+")-0.15],
                        [IC1.posX-0.059, J2.padY("D+")-0.1],
                        [IC1.posX-0.016, IC1.padY("25+")-0.06]],
            IC1.pad("25+"),), w)

board.wire(path(J2.pad("GND"),
            ["bezier", [J2.padX("GND"), J2.padY("GND")-0.29],
                        [IC1.posX+0.01, J2.padY("GND")+0.09],
                        [IC1.posX-0.005, IC1.padY("GND")-0.09]],
            IC1.pad("GND"),), w)

board.wire(path(IC1.pad("VDD"),
            [IC2.padX("out"), IC1.padY("VDD")],
            IC2.pad("out"),), w)

board.wire(path(J2.pad("GND"),
            ["bezier", [J2.padX("GND"), J2.padY("GND")-0.19],
                        [IC2.padX("gnd"), J2.padY("GND")-0.1]],
            IC2.pad("gnd"),), w)

board.wire(path(IC1.pad("VDD"),
            ["bezier", [C1.padX("1")-0.01, IC1.padY("VDD")],
                        [C1.padX("1")-0.15, C1.padY("1")],
                        ],
            C1.pad("1"),), w)

board.wire(path(IC2.pad("gnd"),
            C1.pad("2"),), w)

board.wire(path(C1.pad("2"),
            ["bezier", [C1.padX("2")+0.11, C1.padY("2")-0.05],
                        [C1.padX("2")+0.16, J1.padY("GND")-0.03],
                        [J1.padX("GND"), J1.padY("GND")-0.01]],
            J1.pad("GND"),), w)

board.wire(path(fab.pad("3"),
            ["bezier", [fab.padX("3")+0.21, fab.padY("3")+0.4],
                        [fab.padX("3")+0.64, fab.padY("3")-0.15],
                        [IC1.padX("A05")-0.32, IC1.padY("A05")]],
            IC1.pad("A05"),), w);

board.wire(path(fab.pad("1"),
            ["bezier", [fab.padX("1")+0.2, fab.padY("1")+0.04],
                        [IC1.padX("A14")-0.29, IC1.padY("A14")-0.01]],
            IC1.pad("A14"),), w);

board.wire(path(R1.pad("2"),
            ["bezier", [R1.padX("2")+0.12, R1.padY("2")+0.01]],
            J1.pad("GND"),), w);

board.wire(path(R1.pad("1"),
            LED1.pad("C"),), w);


board.wire(path(LED1.pad("A"),
            ["bezier", [LED1.padX("A")+0.34, LED1.padY("A")+0.03],
                        [J1.padX("DIO")-0.21, J1.padY("DIO")+0.02]],
            J1.pad("DIO"),), w);

board.wire(path(fab.pad("2"),
            ["bezier", [fab.padX("2")+0.42, fab.padY("2")-0.43],
                        [fab.padX("1")+0.37, fab.padY("1")+0.11],
                        [IC1.padX("A15")-0.3, IC1.padY("A15")-0.01]],
            IC1.pad("A15"),), w);

board.wire(path(J2.pad("5V"),
            ["bezier", [J2.padX("5V"), J2.padY("5V")-0.44],
                        [fab.posX-0.27, fab.padY("1")+0.92]],
            [fab.posX-0.47, fab.padY("1")+0.1],
            ["bezier", [fab.posX-0.56, fab.padY("1")-0.91],
                        [IC2.padX("in")+0.06, IC2.padY("in")-0.79],
                        [J1.padX("GND")-1.07, J1.padY("GND")-0.26],
                        [IC2.padX("in")+0.54, IC2.padY("in")-0.74]],
            IC2.pad("in"),), w);

/* -- RENDER_PCB -- */
renderPCB({
  pcb: board,
  layerColors: {
    "interior": "#002d00ff",
    "B.Cu": "#ff4c007f",
    "F.Cu": "#ff8c00cc",
    "drill": "#ff3300e5",
    "padLabels": "#ffff99e5",
    "componentLabels": "#00e5e5e5",
  },
  limits: {
    x: [x-border, x+width+border],
    y: [y-border, y+height+border]
  },
  mm_per_unit: 25.4
})
