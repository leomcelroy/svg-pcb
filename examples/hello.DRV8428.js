const DRV8428_HTSSOP = {"VM":{"shape":"M 0.029,0.0053L -0.029,0.0053L -0.0292,0.0053L -0.0294,0.0053L -0.0297,0.0053L -0.0299,0.0052L -0.0303,0.0051L -0.0305,0.0051L -0.0306,0.005L -0.0308,0.005L -0.031,0.0049L -0.0313,0.0048L -0.0318,0.0045L -0.032,0.0044L -0.0323,0.0042L -0.0324,0.0041L -0.0325,0.0039L -0.0327,0.0038L -0.0329,0.0036L -0.0331,0.0034L -0.0332,0.0033L -0.0333,0.0031L -0.0334,0.003L -0.0335,0.0028L -0.0336,0.0026L -0.0337,0.0025L -0.0338,0.0022L -0.0339,0.002L -0.034,0.0018L -0.034,0.0016L -0.0341,0.0013L -0.0342,0.0011L -0.0342,0.0009L -0.0342,0.0007L -0.0343,0.0006L -0.0343,0.0004L -0.0343,-0.0004L -0.0343,-0.0006L -0.0342,-0.0007L -0.0342,-0.0009L -0.0342,-0.0011L -0.0341,-0.0013L -0.034,-0.0016L -0.034,-0.0018L -0.0339,-0.002L -0.0338,-0.0022L -0.0337,-0.0025L -0.0336,-0.0026L -0.0335,-0.0028L -0.0334,-0.003L -0.0333,-0.0031L -0.0332,-0.0033L -0.0331,-0.0034L -0.0329,-0.0036L -0.0327,-0.0038L -0.0325,-0.0039L -0.0324,-0.0041L -0.0323,-0.0042L -0.032,-0.0044L -0.0318,-0.0045L -0.0313,-0.0048L -0.031,-0.0049L -0.0308,-0.005L -0.0306,-0.005L -0.0305,-0.0051L -0.0303,-0.0051L -0.0299,-0.0052L -0.0297,-0.0053L -0.0294,-0.0053L -0.0292,-0.0053L -0.029,-0.0053L 0.029,-0.0053L 0.029,0.0053","pos":[-0.12,0.0896],"layers":["F.Cu"],"index":1},"PGND":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,0.064],"layers":["F.Cu"],"index":2},"AOUT1":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,0.0384],"layers":["F.Cu"],"index":3},"AOUT2":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,0.0128],"layers":["F.Cu"],"index":4},"BOUT2":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,-0.0128],"layers":["F.Cu"],"index":5},"BOUT1":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,-0.0384],"layers":["F.Cu"],"index":6},"GND1":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,-0.064],"layers":["F.Cu"],"index":7},"GND2":{"shape":"M -0.06,0.09L 0.06,0.09L 0.06,-0.09L -0.06,-0.09L -0.06,0.09","pos":[0,0],"layers":["F.Cu"],"index":17},"DVDD":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[-0.12,-0.0896],"layers":["F.Cu"],"index":8},"VREF":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,-0.0896],"layers":["F.Cu"],"index":9},"M0":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,-0.064],"layers":["F.Cu"],"index":10},"DECAY":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,-0.0384],"layers":["F.Cu"],"index":11},"M1":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,-0.0128],"layers":["F.Cu"],"index":12},"STEP":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,0.0128],"layers":["F.Cu"],"index":13},"DIR":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,0.0384],"layers":["F.Cu"],"index":14},"EN":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,0.064],"layers":["F.Cu"],"index":15},"SLEEP":{"shape":"M -0.029,0.0053L 0.029,0.0053L 0.029,-0.0053L -0.029,-0.0053L -0.029,0.0053","pos":[0.12,0.0896],"layers":["F.Cu"],"index":16}};
const header_FTDI = {"GND":{"shape":"M 0.05,0.025L -0.05,0.025L -0.0509,0.025L -0.0517,0.025L -0.0535,0.0248L -0.0552,0.0244L -0.056,0.0243L -0.0578,0.0237L -0.0593,0.0232L -0.0602,0.0229L -0.061,0.0225L -0.0618,0.0221L -0.0625,0.0216L -0.0633,0.0212L -0.064,0.0208L -0.0654,0.0197L -0.0661,0.0191L -0.0668,0.0186L -0.0686,0.0168L -0.0691,0.0161L -0.0697,0.0154L -0.0708,0.014L -0.0712,0.0133L -0.0716,0.0125L -0.0721,0.0118L -0.0725,0.011L -0.0729,0.0102L -0.0732,0.0093L -0.0737,0.0078L -0.0743,0.006L -0.0744,0.0052L -0.0748,0.0035L -0.075,0.0017L -0.075,0.0009L -0.075,0L -0.075,-0.0009L -0.075,-0.0017L -0.0748,-0.0035L -0.0744,-0.0052L -0.0743,-0.006L -0.0737,-0.0078L -0.0732,-0.0093L -0.0729,-0.0102L -0.0725,-0.011L -0.0721,-0.0118L -0.0716,-0.0125L -0.0712,-0.0133L -0.0708,-0.014L -0.0697,-0.0154L -0.0691,-0.0161L -0.0686,-0.0168L -0.0668,-0.0186L -0.0661,-0.0191L -0.0654,-0.0197L -0.064,-0.0208L -0.0633,-0.0212L -0.0625,-0.0216L -0.0618,-0.0221L -0.061,-0.0225L -0.0602,-0.0229L -0.0593,-0.0232L -0.0578,-0.0237L -0.056,-0.0243L -0.0552,-0.0244L -0.0535,-0.0248L -0.0517,-0.025L 0.05,-0.025L 0.05,0.025","pos":[0,0.25],"layers":["F.Cu"],"index":1},"CTS":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.15],"layers":["F.Cu"],"index":2},"VCC":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.05],"layers":["F.Cu"],"index":3},"Tx":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.05],"layers":["F.Cu"],"index":4},"Rx":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.15],"layers":["F.Cu"],"index":5},"RTS":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.25],"layers":["F.Cu"],"index":6}};
const header_4H = {"1":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.15],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.05],"layers":["F.Cu"],"index":2},"3":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.05],"layers":["F.Cu"],"index":3},"4":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.15],"layers":["F.Cu"],"index":4}};
const C_1206 = {"1":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}};
const ST4EB = {"1":{"shape":"M -0.032,0.039L 0.032,0.039L 0.032,-0.039L -0.032,-0.039L -0.032,0.039","pos":[-0.046,-0.118],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032,0.039L 0.032,0.039L 0.032,-0.039L -0.032,-0.039L -0.032,0.039","pos":[0.046,-0.118],"layers":["F.Cu"],"index":2},"3":{"shape":"M -0.039,0.039L 0.039,0.039L 0.039,-0.039L -0.039,-0.039L -0.039,0.039","pos":[0,0.118],"layers":["F.Cu"],"index":3}};
const R_1206 = {"1":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[-0.06,0],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.032,0.034L 0.032,0.034L 0.032,-0.034L -0.032,-0.034L -0.032,0.034","pos":[0.06,0],"layers":["F.Cu"],"index":2}};
const C_FND = {"+":{"shape":"M -0.032,0.06L 0.032,0.06L 0.032,-0.06L -0.032,-0.06L -0.032,0.06","pos":[0,0.11],"layers":["F.Cu"],"index":1},"-":{"shape":"M -0.032,0.06L 0.032,0.06L 0.032,-0.06L -0.032,-0.06L -0.032,0.06","pos":[0,-0.11],"layers":["F.Cu"],"index":2}};
const header_2H = {"1":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,0.05],"layers":["F.Cu"],"index":1},"2":{"shape":"M -0.05,0.025L 0.05,0.025L 0.05,-0.025L -0.05,-0.025L -0.05,0.025","pos":[0,-0.05],"layers":["F.Cu"],"index":2}};


// commands:
//  - SHIFT+ENTER: render
//  - drap & drop file: kicad import


// constants
const width = 1.235 // board width
const height = .99 // board height
const x = 1 // x origin
const y = 1 // y origin
const zt = 0 // top z
const zb = -0.06 // bottom z
const w = .0106 // wire width
const w1 = .015 // thicker wire width
const w2 = .03 // thickest wire width
const mask = .004 // solder mask size
const border = 0.05 // rendering border


/* -- DECLARE_PCB -- */
let board = new PCB();

let interior = geo.translate(geo.rectangle(width, height), [x+width/2, y+height/2]);


/* -- ADD_COMPONENTS -- */
let IC1 = board.add(DRV8428_HTSSOP, {translate: pt(x+.6, y+.555), name: 'IC1\nDRV8428'});
let J1 = board.add(header_FTDI, {translate: pt(x+width-.23, IC1.posY-.2), name: 'J1\nFTDI'});
let J2 = board.add(header_4H, {translate: pt(x+.23, IC1.posY-.24), rotate: 180, name: 'J2\nstepper'});
let C1 = board.add(C_1206, {translate: pt(J2.posX, J2.padY("1")-.1), name: 'C1\n1uF'});
let R1 = board.add(ST4EB, {translate: pt(IC1.posX-.17, IC1.posY-.32), name: 'R1\n10k'});
let R2 = board.add(R_1206, {translate: pt(IC1.posX-.01, IC1.posY-.44), rotate: 90, name: 'R2\n10k'});
let R3 = board.add(R_1206, {translate: pt(IC1.posX, IC1.posY-.22), rotate: 90, name: 'R3'});
let R4 = board.add(R_1206, {translate: pt(R3.posX+.09, R3.posY-.22), rotate: 90, name: 'R4\n0'});
let R5 = board.add(R_1206, {translate: pt(R3.posX+.1, R3.posY), rotate: 90, name: 'R5'});
let R6 = board.add(R_1206, {translate: pt(R5.posX+.09, R4.posY), rotate: 90, name: 'R6\n0'});
let C2 = board.add(C_FND, {translate: pt(IC1.padX("VM"), IC1.posY+.27), rotate: 90, name: 'C2\n100uF'});
let J3 = board.add(header_2H, {translate: pt(x+.23, IC1.padY("VM")+.05), rotate: 180, name: 'J3\npower'});
let R7 = board.add(R_1206, {translate: pt(J1.posX, C2.posY), name: 'R7\n0'});
let C3 = board.add(C_1206, {translate: pt(C2.posX+.3, C2.posY), name: 'C3\n.01uF'});

board.addShape("interior", interior);


/* -- ADD_WIRES -- */
board.wire(path(IC1.pad("PGND"),
                pt(IC1.posX, IC1.padY("PGND"))), w);

board.wire(path(IC1.pad("PGND"),
                pt(IC1.padX("PGND")-.05, IC1.padY("PGND"))), w);

board.wire(path(IC1.pad("GND1"),
                pt(IC1.posX, IC1.padY("GND1"))), w);

board.wire(path(IC1.pad("GND1"),
                pt(IC1.padX("GND1")-.05, IC1.padY("GND1"))), w);

board.wire(path(IC1.pad("DECAY"),
                pt(IC1.posX, IC1.padY("DECAY"))), w);

board.wire(path(IC1.pad("DECAY"),
                pt(IC1.padX("DECAY")+.075, IC1.padY("DECAY"))), w);

board.wire(path(IC1.pad("SLEEP"),
                pt(IC1.padX("SLEEP")+.128, IC1.padY("SLEEP")),
                pt(IC1.padX("SLEEP")+.128, IC1.padY("EN")),
                pt(IC1.padX("SLEEP")+.18, IC1.padY("EN")),
                pt(IC1.padX("SLEEP")+.18, J1.padY("VCC")),
                J1.pad("VCC")), w);

board.wire(path(IC1.pad("EN"),
                pt(IC1.padX("EN")+.18, IC1.padY("EN")),
                pt(IC1.padX("EN")+.18, J1.padY("VCC")),
                J1.pad("VCC")), w);

board.wire(path(IC1.pad("DIR"),
                pt(IC1.padX("DIR")+.154, IC1.padY("DIR")),
                pt(IC1.padX("DIR")+.154, J1.padY("Tx")+.05),
                pt(J1.posX-.05, J1.padY("Tx")),
                J1.pad("Tx")), w);

board.wire(path(IC1.pad("STEP"),
                pt(IC1.padX("STEP")+.128, IC1.padY("STEP")),
                pt(IC1.padX("STEP")+.128, J1.padY("Tx")),
                pt(J1.posX-.05, J1.padY("Rx")+.02),
                J1.pad("Rx")), w);

board.wire(path(J1.pad("GND"),
                pt(J1.posX, J1.padY("GND")+.09),
                pt(IC1.posX, J1.padY("GND")+.09),
                IC1.pad("GND2")), w2);

board.wire(path(IC1.pad("AOUT1"),
                pt(J2.posX-.152, IC1.padY("AOUT1")),
                pt(J2.posX-.152, J2.padY("1")),
                J2.pad("1")), w);

board.wire(path(IC1.pad("AOUT2"),
                pt(J2.posX-.126, IC1.padY("AOUT2")),
                pt(J2.posX-.126, J2.padY("2")),
                J2.pad("2")), w);

board.wire(path(IC1.pad("BOUT2"),
                pt(J2.posX-.1, IC1.padY("BOUT2")),
                pt(J2.posX-.1, J2.padY("3")),
                J2.pad("3")), w);

board.wire(path(IC1.pad("BOUT1"),
                pt(J2.posX, IC1.padY("BOUT1")),
                J2.pad("4")), w);

board.wire(path(IC1.pad("DVDD"),
                pt(C1.padX("2")+.022, IC1.padY("DVDD")),
                pt(C1.padX("2")+.022, C1.posY),
                C1.pad("2")), w);

board.wire(path(C1.pad("2"),
                pt(C1.padX("2"), C1.posY-.03),
                pt(R2.posX, C1.posY-.03),
                R2.pad("1")), w1);

board.wire(path(R2.pad("2"),
                R1.pad("2")), w1);

board.wire(path(R3.pad("2"),
                IC1.pad("GND2")), w1);

board.wire(path(R1.pad("1"),
                pt(R1.padX("1")-.03, R1.padY("1")),
                pt(R1.padX("1")-.03, R3.padY("2")+.03),
                pt(R3.posX, R3.padY("2")+.03),
                R3.pad("2")), w1);

board.wire(path(R4.pad("1"),
                R2.pad("1")), w1);

board.wire(path(R3.pad("1"),
                R4.pad("2")), w1);

board.wire(path(R5.pad("2"),
                R3.pad("2")), w1);

board.wire(path(IC1.pad("VREF"),
                pt(IC1.padX("VREF")+.05, IC1.padY("VREF")),
                pt(IC1.padX("VREF")+.05, R5.posY),
                pt(R1.padX("3"), R5.posY),
                R1.pad("3")), w);

board.wire(path(R6.pad("1"),
                R4.pad("1")), w1);

board.wire(path(R5.pad("1"),
                R6.pad("2")), w1);

board.wire(path(IC1.pad("M0"),
                pt(IC1.padX("VREF")+.076, IC1.padY("M0")),
                pt(IC1.padX("VREF")+.076, R5.padY("1")),
                R5.pad("1")), w);

board.wire(path(IC1.pad("M1"),
                pt(IC1.padX("M1")+.102, IC1.padY("M1")),
                pt(IC1.padX("M1")+.102, J1.padY("Tx")-.035),
                pt(IC1.padX("M1")+.135, J1.padY("Tx")-.06),
                pt(IC1.padX("M1")+.135, R4.posY),
                pt(R4.posX, R4.posY),
                R4.pad("2")), w);

board.wire(path(C2.pad("+"),
                pt(C2.padX("+"), IC1.padY("VM"))), w2);

board.wire(path(pt(C2.padX("+"), IC1.padY("VM")),
                IC1.pad("VM")), w);

board.wire(path(C2.pad("-"),
                pt(IC1.posX, C2.posY),
                IC1.pad("GND2")), w2);

board.wire(path(J3.pad("1"),
                pt(C2.padX("+"), J3.padY("1"))), w2);

board.wire(path(J3.pad("2"),
                pt(J3.posX, C2.posY+.13),
                pt(J1.posX, C2.posY+.13)), w2);

board.wire(path(pt(J1.posX, C2.posY+.13),
                J1.pad("GND")), w1);

board.wire(path(J3.pad("2"),
                pt(J3.posX-.18, J3.padY("2")),
                pt(J3.posX-.18, C1.padY("1")),
                C1.pad("1")), w1);

board.wire(path(J1.pad("VCC"),
                pt(J1.posX+.11, J1.padY("VCC")),
                pt(J1.posX+.11, R7.posY),
                R7.pad("2")), w2);

board.wire(path(C2.pad("-"),
                C3.pad("1")), w2);

board.wire(path(C3.pad("2"),
                R7.pad("1")), w2);

board.wire(path(C3.pad("2"),
                pt(C3.padX("2"), C3.posY+.08),
                pt(C2.padX("+"), C3.posY+.08),
                C2.pad("+")), w2);


// rendering
renderPCB({
  pcb: board,
  layerColors: {
    "interior": "#002d00ff",
    "B.Cu": "#ff4c007f",
    "F.Cu": "#ff8c00cc",
    "drill": "#ff3300e5",
    "padLabels": "#ffff99e5",
    "componentLabels": "#00e5e5e5",
  },
  limits: {
    x: [x-border, x+width+border],
    y: [y-border, y+height+border]
  },
  mm_per_unit: 25.4
})
